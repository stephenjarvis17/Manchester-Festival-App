

<!-- admin-event -->

<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

 <!-- norman -->
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icons/notification-icons.html">
<link rel="import" href="../../bower_components/firebase-element/firebase-collection.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-dialog-behavior/paper-dialog-behavior.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/google-map/google-map.html">

<!-- third party -->
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid.html">


<!-- <link rel="import" href="styles/app-theme.html">
<link rel="import" href="styles/shared-styles.html"> -->
 <!-- end of norman -->

<dom-module id="admin-ad-list">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host {
        display: block;
      }
      paper-scroll-header-panel {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        min-height: 1400px;
        background-color: var(--paper-grey-200, #eee);
      }
      .content {
        padding: 8px;
      }
      .bottom {
        padding-left: 62px;
      }
      paper-input {
        display: inline-block;
      }
      td{
        height: 400px;
      }
    </style>

    <firebase-collection location="https://legendmanchesterma.firebaseIO.com/event" order-by-child="name" data="{{eventCollection}}"></firebase-collection>

    <paper-scroll-header-panel keep-condensed-header>
      <div class="content">
        <paper-input id="filter" label="Filter by name: TODO"></paper-input>
        
        <vaadin-grid id='gridEvents' on-selected-items-changed="gridItemSelected">
          <table>
            <colgroup id='gridcolgroup'>
              <col id='name' sortable="">
              <col id='description' sortable="">
              <col id='startDate' sortable="">
              <col id='startTime' sortable="">
              <col id='endData' sortable="">
              <col id='endTime' sortable="">
              <!-- <col id='location'> -->
              <col id='latitude'>
              <col id='longitude'>
            </colgroup>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Start Date</th>
                    <th>Start Time</th>
                    <th>End Date</th>
                    <th>End Time</th>
                    <!-- <th>Location Object</th> -->
                    <th>Latitude</th>
                    <th>Longitude</th>
                </tr>
            </thead>
            <tbody>
              <template is="dom-repeat" items="[[eventCollection]]" as="event" >
                  <tr>
                      <td>[[event.name]]</td>
                      <td>[[event.description]]</td>
                      <td>[[event.startDate]]</td>
                      <td>[[event.startTime]]</td>
                      <td>[[event.endDate]]</td>
                      <td>[[event.endTime]]</td>
                     <!--  need to scale down the map or pop out or expand
                     <td>
                        <google-map latitude="37.77493" longitude="-122.41942" zoom="20" fit-to-markers mouseEvents="true" >
                          <google-map-marker latitude="[[event.location.latitude]]" longitude="[[event.location.longitude]]"  on-google-map-marker-mouseup="markerMoved" animation="DROP" mouse-events="true" title="The Event Location" latitude="[[event.location.latitude]]" longitude="[[event.location.longitude]]" ></google-map-marker>
                        </google-map> 
                      </td>-->
                      <td>[[event.location.latitude]]</td>
                      <td>[[event.location.longitude]]</td>
                  </tr>
              </template>
            </tbody>
          </table>
        </vaadin-grid>

        <paper-button raised on-click="_submit">Test</paper-button>
      </div>
    </paper-scroll-header-panel>
  </template>

  <script>
    Polymer({
      is: 'admin-ad-list',
      properties: {
        eventCollection: {
          type: Object
        },
        selectedItem: {
          type: Object
        }
      },
      listeners: {
        'gridEvents.sort-order-changed': '_sortOrderChanged'
      }, 
      gridItemSelected: function() {  
        this.$.gridEvents.getItem([this.$.gridEvents.selection.selected()], function(err, item) {
          this.selectedItem = item;
          if (this.selectedItem) {
            console.log('Selected Grid Item: ' + this.selectedItem);
          }
        });
      },
      _sortOrderChanged(val, ord) {
        if (!this.eventCollection || this.eventCollection.length === 0) {
          return;
        }

        if (ord.value && ord.value.length > 0) {
          var columnIndexToSort = ord.value[0].column;
          var children = this.$.gridcolgroup.children.length;

          if (columnIndexToSort < children) {
            var columnIdObjName = this.$.gridcolgroup.getElementsByTagName('col')[columnIndexToSort].id;
            var direction = ord.value[0].direction;
            var lesser = direction === 'asc' ? -1 : 1;
            var tempArray = Array.prototype.slice.call(this.eventCollection);

            console.log(direction);
            tempArray.sort(function(a, b) {
              // todo this._computeSort(columnIdObjName, lesser));
              // todo: spin off of types
              if (a[columnIdObjName] === b[columnIdObjName]) {
                console.log('the same value');
                return 0;
              }
              return (a[columnIdObjName] < b[columnIdObjName]) ? lesser: -lesser;
            });
            
            this.eventCollection = tempArray;
          }
        }
      },
      _submit: function() {
        return;
      },
      _popToast: function(newValue) {
        this.$.toast.text = newValue;
        this.$.toast.show();
      }
      // // not working yet
      // _computeSort: function(name, lesser) {
      //   return function(a, b) {
      //     // stings only
      //     // todo: spin off of types
      //     if (a[name] === b[name]) {
      //       return 0;
      //     }
      //     return (a[name] < b[name]) ? lesser: -lesser;
      //   };
      // }

    });
  </script>
</dom-module>
